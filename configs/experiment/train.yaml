# @package _global_
defaults:
  - /model/backbone: resnet
  - /model/classifier_head: single_lin_layer
  - /data/datasets@data.dataset: CelebA
  - /data/transforms@data.train.transforms: train
  - /data/transforms@data.val.transforms: base
  - /data/transforms@data.test.transforms: base

checkpoint: null

mode: fit

trainer:
  callbacks:
    - _target_: lightning.pytorch.callbacks.ModelCheckpoint
      save_top_k: 1
      monitor: validation/loss
      mode: min
    - _target_: lightning.pytorch.callbacks.EarlyStopping
      monitor: validation/loss
      mode: min
      patience: 5

model:
  lr_backbone: 1e-5
  lr_class_head: 3e-4
  bottleneck_num_classes: 39

backbone_params:
  requires_grad: true
  pretrained: true

class_head_params:
  input_dim: 512 # must match backbone output features
  num_concepts: ${model.bottleneck_num_classes}

data:
  batch_size: 16
  predict_on_train: false
  dataset:
    concept_mode: true # targets are concepts (39)

metadata:
  experiment_name: Concept Model
  run_name: "Train Concept Model"
  description: ""
  hyperparams:
    lr_backbone: ${model.lr_backbone}
    lr_class_head: ${model.lr_class_head}
    bottleneck_num_classes: ${model.bottleneck_num_classes}
