# @package _global_
defaults:
  - /model/backbone: resnet
  - /model/classifier_head: single_lin_layer
  - /data/datasets@data.dataset: CelebA
  - /data/transforms@data.train.transforms: base # do not apply train transforms!
  - /data/transforms@data.val.transforms: base
  - /data/transforms@data.test.transforms: base

checkpoint: "/home/jovyan/ia176/models/epoch=4-step=50865.ckpt"

mode: predict # we need model in eval mode

trainer:
  callbacks:
    # save Concept Model's train set predictions for the Decision Tree training
    - _target_: ia176.callbacks.prediction_saver.PredictionCallback
      save_path: "/home/jovyan/ia176/predictions/train_concepts"

model:
  lr_backbone: 1e-5
  lr_class_head: 3e-4
  bottleneck_num_classes: 39

backbone_params:
  requires_grad: true
  pretrained: true

class_head_params:
  input_dim: 512 # must match backbone output features
  num_concepts: ${model.bottleneck_num_classes}

data:
  batch_size: 1
  predict_on_train: true # predictions on the train set
  dataset:
    concept_mode: true # targets are concepts (39)

metadata:
  experiment_name: Concept Model
  run_name: "Predictions on the Train Set"
  description: "Compute train data predictions for the Decision Tree."
  hyperparams:
    lr_backbone: ${model.lr_backbone}
    lr_class_head: ${model.lr_class_head}
    bottleneck_num_classes: ${model.bottleneck_num_classes}
